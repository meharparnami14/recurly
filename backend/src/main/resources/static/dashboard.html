<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard – Recurly</title>

  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&family=Inter&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="dashboard.css">
</head>
<body>

  <aside class="sidebar">
    <h1 class="brand">RECURLY</h1>

    <p class="tagline">
      Track, control, and stay on top<br>
      of every recurring payment from<br>
      one place.
    </p>

    <a href="add-subscription.html" class="side-btn">Add Subscription</a>
    <a href="history.html" class="side-btn">View History</a>
    <a href="tracking.html" class="side-btn">Track Spending</a>

    <footer>
      <p>Manage. Track. Save.</p>
      <p>Secure subscription management</p>
      <p>© 2026 Recurly</p>
    </footer>
  </aside>

  <main class="content">

    <div class="top">
      <img src="./assets/lp2.png" class="card-img" alt="Card preview">

      <div class="welcome">
        <h2>Hello Mehar,</h2>
        <p>good to see you again</p>
      </div>
    </div>

    <h3 class="section-title">SUBSCRIPTION LIST</h3>

    <div id="subscription-list">
      <div class="loading-container">
        <div class="loading"></div>
      </div>
    </div>

  </main>

<script>
  const subscriptionList = document.getElementById("subscription-list");

  fetch("/subscriptions")
    .then(res => {
      if (!res.ok) throw new Error('Failed to load subscriptions');
      return res.json();
    })
    .then(subscriptions => {
      subscriptionList.innerHTML = '';

      if (subscriptions.length === 0) {
        subscriptionList.innerHTML = '<div class="empty-state"><p>No subscriptions yet. Add one to get started!</p></div>';
        return;
      }

      subscriptions.forEach((sub, index) => {
        const div = document.createElement("div");
        div.className = "subscription";
        div.style.animationDelay = `${index * 0.1}s`;

        div.innerHTML = `
          <span>${sub.name}</span>
          <span>₹${sub.amount}/${sub.billingCycle}</span>
          <a href="confirm-payment.html?name=${encodeURIComponent(sub.name)}&amount=${sub.amount}" class="pay">PAY NOW</a>
          <span class="delete" onclick="deleteSubscription(${sub.id})">delete subscription</span>
        `;

        subscriptionList.appendChild(div);
      });
    })
    .catch(err => {
      console.error("Error loading subscriptions", err);
      subscriptionList.innerHTML = '<div class="error-message">Failed to load subscriptions. Please try again later.</div>';
    });

  function deleteSubscription(id) {
    if (!confirm('Are you sure you want to delete this subscription?')) return;

    fetch(`/subscriptions/${id}`, {
      method: 'DELETE'
    })
    .then(res => {
      if (!res.ok) throw new Error('Failed to delete subscription');
      location.reload();
    })
    .catch(err => {
      console.error("Error deleting subscription", err);
      alert('Failed to delete subscription. Please try again.');
    });
  }
</script>

</body>
</html>
